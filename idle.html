<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Idle Goose Game</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Arial", sans-serif;
                background: linear-gradient(135deg, #87ceeb 0%, #98fb98 100%);
                min-height: 100vh;
                padding: 20px;
                color: #333;
            }

            .game-container {
                max-width: 1600px;
                min-height: 800px;
                margin: 0 auto;
                background: rgba(255, 255, 255, 0.9);
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            }

            .main-area {
                display: flex;
                gap: 30px;
                align-items: flex-start;
            }

            .game-content {
                flex: 1;
            }

            .sidebar {
                width: 400px;
                flex-shrink: 0;
            }

            .panel {
                background: rgba(255, 255, 255, 0.9);
                border-radius: 15px;
                padding: 15px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            }

            h1 {
                text-align: center;
                color: #2c3e50;
                margin-bottom: 20px;
                font-size: 2.5em;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 30px;
            }

            .stat-card {
                background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
                padding: 15px;
                border-radius: 10px;
                border: 2px solid #e9ecef;
                text-align: center;
            }

            .stat-value {
                font-size: 1.5em;
                font-weight: bold;
                color: #2c3e50;
            }

            .stat-label {
                color: #6c757d;
                font-size: 0.9em;
                margin-top: 5px;
            }

            .goose-area {
                text-align: center;
                margin: 30px auto;
                width: 100%;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }

            .main-goose {
                font-size: 12em;
                cursor: pointer;
                transition: transform 0.1s;
                user-select: none;
                display: inline-block;
                animation: float 3s ease-in-out infinite;
            }

            .main-goose:hover {
                transform: scale(1.1);
            }

            .main-goose:active {
                transform: scale(0.95);
            }

            @keyframes float {
                0%,
                100% {
                    transform: translateY(0px);
                }
                50% {
                    transform: translateY(-10px);
                }
            }

            @keyframes shake {
                0% {
                    transform: translateX(0px) translateY(0px) rotate(0deg)
                        scale(1);
                }
                10% {
                    transform: translateX(-15px) translateY(-8px) rotate(-5deg)
                        scale(1.05);
                }
                20% {
                    transform: translateX(15px) translateY(-12px) rotate(5deg)
                        scale(1.1);
                }
                30% {
                    transform: translateX(-12px) translateY(-6px) rotate(-3deg)
                        scale(1.08);
                }
                40% {
                    transform: translateX(12px) translateY(-10px) rotate(3deg)
                        scale(1.06);
                }
                50% {
                    transform: translateX(-8px) translateY(-4px) rotate(-2deg)
                        scale(1.04);
                }
                60% {
                    transform: translateX(8px) translateY(-6px) rotate(2deg)
                        scale(1.02);
                }
                70% {
                    transform: translateX(-5px) translateY(-2px) rotate(-1deg)
                        scale(1.01);
                }
                80% {
                    transform: translateX(5px) translateY(-3px) rotate(1deg)
                        scale(1.005);
                }
                90% {
                    transform: translateX(-2px) translateY(-1px) rotate(-0.5deg)
                        scale(1.002);
                }
                100% {
                    transform: translateX(0px) translateY(0px) rotate(0deg)
                        scale(1);
                }
            }

            .main-goose.shake {
                animation: shake 0.6s ease-in-out infinite;
            }

            .click-effect {
                position: absolute;
                color: #28a745;
                font-weight: bold;
                font-size: 1.2em;
                pointer-events: none;
                animation: floatUp 1s ease-out forwards;
            }

            @keyframes floatUp {
                0% {
                    opacity: 1;
                    transform: translateY(0px);
                }
                100% {
                    opacity: 0;
                    transform: translateY(-50px);
                }
            }

            .tab-container {
                background: rgba(255, 255, 255, 0.8);
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                overflow: hidden;
                border: 2px solid #e9ecef;
            }

            .tabs {
                display: flex;
                background: #f8f9fa;
                border-bottom: 2px solid #e9ecef;
            }

            .tab-button {
                flex: 1;
                padding: 10px 12px;
                background: none;
                border: none;
                cursor: pointer;
                font-weight: bold;
                color: #6c757d;
                transition: all 0.3s;
                font-size: 0.9em;
            }

            .tab-button:hover {
                background: rgba(0, 123, 255, 0.1);
                color: #007bff;
            }

            .tab-button.active {
                background: white;
                color: #007bff;
                border-bottom: 3px solid #007bff;
            }

            .tab-content {
                padding: 15px;
                display: none;
                max-height: 400px;
                overflow-y: auto;
            }

            .tab-content.active {
                display: block;
            }

            .upgrades {
                display: grid;
                gap: 10px;
            }

            .upgrade {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
                background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
                border-radius: 8px;
                border: 2px solid #e9ecef;
                transition: all 0.3s;
            }

            .upgrade:hover {
                border-color: #007bff;
                transform: translateY(-2px);
            }

            .upgrade-info {
                flex: 1;
            }

            .upgrade-name {
                font-weight: bold;
                color: #2c3e50;
            }

            .upgrade-description {
                font-size: 0.8em;
                color: #6c757d;
            }

            .upgrade-count {
                background: #007bff;
                color: white;
                border-radius: 50%;
                width: 25px;
                height: 25px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.8em;
                margin-right: 10px;
            }

            .upgrade-buttons {
                display: flex;
                flex-direction: column;
                gap: 4px;
                align-items: flex-end;
            }

            .buy-quantity-row {
                display: flex;
                gap: 3px;
            }

            .upgrade-button {
                background: #28a745;
                color: white;
                border: none;
                padding: 4px 8px;
                border-radius: 4px;
                cursor: pointer;
                font-weight: bold;
                transition: background 0.3s;
                font-size: 0.8em;
                min-width: 35px;
            }

            .upgrade-button:hover {
                background: #218838;
            }

            .upgrade-button:disabled {
                background: #6c757d;
                cursor: not-allowed;
            }

            .upgrade-button.max {
                background: #dc3545;
            }

            .upgrade-button.max:hover {
                background: #c82333;
            }

            .upgrade-cost {
                font-size: 0.75em;
                color: #6c757d;
                text-align: right;
                margin-top: 2px;
            }

            .achievements {
                max-height: 200px;
                overflow-y: auto;
            }

            .achievement {
                padding: 8px;
                margin: 5px 0;
                background: #fff3cd;
                border-radius: 5px;
                border-left: 4px solid #ffc107;
                font-size: 0.9em;
            }

            .achievement.unlocked {
                background: #d4edda;
                border-left-color: #28a745;
            }

            .prestige-section {
                text-align: center;
                margin-top: 20px;
            }

            .prestige-button {
                background: #dc3545;
                color: white;
                border: none;
                padding: 15px 30px;
                border-radius: 10px;
                font-size: 1.1em;
                font-weight: bold;
                cursor: pointer;
                transition: background 0.3s;
            }

            .prestige-button:hover {
                background: #c82333;
            }

            .prestige-button:disabled {
                background: #6c757d;
                cursor: not-allowed;
            }

            .mobile-menu-toggle {
                display: none;
                background: #007bff;
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: bold;
                cursor: pointer;
                width: 100%;
                margin-bottom: 15px;
            }

            .mobile-menu-toggle:hover {
                background: #0056b3;
            }

            .mobile-stats {
                display: none;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
                margin-bottom: 20px;
            }

            .decorative-apples {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                pointer-events: none;
                z-index: -1;
                overflow: hidden;
            }

            .apple {
                position: absolute;
                font-size: 3em;
                opacity: 0.7;
                animation: fall linear infinite;
                user-select: none;
            }

            .apple:nth-child(odd) {
                animation-delay: -2s;
            }

            .apple:nth-child(3n) {
                animation-delay: -4s;
            }

            .apple:nth-child(4n) {
                animation-delay: -6s;
            }

            @keyframes fall {
                0% {
                    transform: translateY(-100px);
                    opacity: 0;
                }
                10% {
                    opacity: 0.7;
                }
                90% {
                    opacity: 0.7;
                }
                100% {
                    transform: translateY(calc(100vh + 100px));
                    opacity: 0;
                }
            }

            @media (max-width: 768px) {
                .stats {
                    display: none;
                }

                .mobile-stats {
                    display: grid;
                }

                .mobile-menu-toggle {
                    display: block;
                }

                .sidebar.mobile-open #mobileMenuClose {
                    display: block !important;
                }

                .main-area {
                    flex-direction: column;
                }

                .game-content {
                    width: 100%;
                    text-align: center;
                }

                .sidebar {
                    width: 100%;
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(255, 255, 255, 0.98);
                    z-index: 1000;
                    display: none;
                    overflow-y: auto;
                    padding: 20px;
                }

                .sidebar.mobile-open {
                    display: block;
                }

                .goose-area {
                    margin: 20px auto;
                    text-align: center;
                    width: 100%;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                }

                .main-goose {
                    font-size: 10em;
                }

                .tab-container {
                    display: block;
                }
            }
        </style>
    </head>
    <body>
        <div class="decorative-apples" id="decorativeApples"></div>
        <div class="game-container">
            <h1>ü™ø Idle Goose Game ü™ø</h1>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="apples">0</div>
                    <div class="stat-label">Apples</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="applesPerSecond">0</div>
                    <div class="stat-label">Per Second</div>
                </div>
            </div>

            <div class="mobile-stats">
                <div class="stat-card">
                    <div class="stat-value" id="mobileApples">0</div>
                    <div class="stat-label">Apples</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="mobileApplesPerSecond">0</div>
                    <div class="stat-label">Per Second</div>
                </div>
            </div>

            <div class="main-area">
                <div class="game-content">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        üì± Show Menu
                    </button>
                    <div class="goose-area">
                        <div class="main-goose" id="mainGoose">ü™ø</div>
                        <p>Click the goose to gather apples!</p>
                    </div>
                </div>

                <div class="sidebar">
                    <button
                        class="mobile-menu-toggle"
                        id="mobileMenuClose"
                        style="display: none"
                    >
                        ‚ùå Close Menu
                    </button>
                    <div class="tab-container">
                        <div class="tabs">
                            <button class="tab-button active" id="upgradesTab">
                                üè™ Passive
                            </button>
                            <button class="tab-button" id="clickTab">
                                üëÜ Click
                            </button>
                            <button class="tab-button" id="autoTab">
                                ü§ñ Auto
                            </button>
                            <button class="tab-button" id="achievementsTab">
                                üèÜ Achievements
                            </button>
                        </div>

                        <div class="tab-content active" id="upgradesContent">
                            <div class="upgrades" id="upgrades"></div>
                        </div>

                        <div class="tab-content" id="clickContent">
                            <div class="upgrades" id="clickUpgrades"></div>
                        </div>

                        <div class="tab-content" id="autoContent">
                            <div class="upgrades" id="autoUpgrades"></div>
                        </div>

                        <div class="tab-content" id="achievementsContent">
                            <div class="achievements" id="achievements"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            class IdleGooseGame {
                constructor() {
                    this.gameState = {
                        apples: 0,
                        totalApples: 0,
                        applesPerSecond: 0,
                        clickPower: 1,
                        totalClicks: 0,
                        prestigeLevel: 0,
                        prestigeMultiplier: 1,
                        upgrades: {},
                        achievements: new Set(),
                        buyQuantity: 1,
                        lastSaveTime: Date.now(),
                        autoClicksPerSecond: 0,
                    };

                    // Click tracking for dynamic per second calculation
                    this.clickTimes = [];
                    this.dynamicClicksPerSecond = 0;
                    this.shakeTimeout = null;
                    this.autoClickInterval = null;

                    this.upgrades = [
                        {
                            id: "helper_duck",
                            name: "ü™ø Helper Goose",
                            description: "+0.1 apples/sec",
                            baseCost: 10,
                            bpsIncrease: 0.1,
                            costMultiplier: 1.15,
                            type: "passive",
                        },
                        {
                            id: "pond",
                            name: "üèûÔ∏è Pond",
                            description: "+0.5 apples/sec",
                            baseCost: 100,
                            bpsIncrease: 0.5,
                            costMultiplier: 1.15,
                            type: "passive",
                        },
                        {
                            id: "duck_family",
                            name: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Goose Family",
                            description: "+2 apples/sec",
                            baseCost: 500,
                            bpsIncrease: 2,
                            costMultiplier: 1.15,
                            type: "passive",
                        },
                        {
                            id: "bread_factory",
                            name: "üè≠ Apple Orchard",
                            description: "+8 apples/sec",
                            baseCost: 2000,
                            bpsIncrease: 8,
                            costMultiplier: 1.15,
                            type: "passive",
                        },
                        {
                            id: "goose_army",
                            name: "ü™øü™øü™ø Goose Army",
                            description: "+20 apples/sec",
                            baseCost: 10000,
                            bpsIncrease: 20,
                            costMultiplier: 1.15,
                            type: "passive",
                        },
                        {
                            id: "golden_goose",
                            name: "‚ú® Golden Goose",
                            description: "+50 apples/sec",
                            baseCost: 50000,
                            bpsIncrease: 50,
                            costMultiplier: 1.15,
                            type: "passive",
                        },
                        {
                            id: "mutant_apple_tree",
                            name: "üçè Mutant Apple Tree",
                            description: "+150 apples/sec",
                            baseCost: 200000,
                            bpsIncrease: 150,
                            costMultiplier: 1.15,
                            type: "passive",
                        },
                        {
                            id: "disco_goose",
                            name: "ü™© Disco Goose",
                            description: "+500 apples/sec",
                            baseCost: 1000000,
                            bpsIncrease: 500,
                            costMultiplier: 1.15,
                            type: "passive",
                        },
                        {
                            id: "scientist_goose",
                            name: "üß™ Scientist Goose",
                            description: "+2,000 apples/sec",
                            baseCost: 5000000,
                            bpsIncrease: 2000,
                            costMultiplier: 1.15,
                            type: "passive",
                        },
                        {
                            id: "apple_cloning_lab",
                            name: "üß¨ Apple Cloning Lab",
                            description: "+10,000 apples/sec",
                            baseCost: 25000000,
                            bpsIncrease: 10000,
                            costMultiplier: 1.15,
                            type: "passive",
                        },
                        {
                            id: "celestial_orchard",
                            name: "‚òÄÔ∏è Celestial Orchard",
                            description: "+50,000 apples/sec",
                            baseCost: 150000000,
                            bpsIncrease: 50000,
                            costMultiplier: 1.15,
                            type: "passive",
                        },
                        {
                            id: "divine_goose",
                            name: "ü™Ω Divine Goose",
                            description: "+250,000 apples/sec",
                            baseCost: 1000000000,
                            bpsIncrease: 250000,
                            costMultiplier: 1.15,
                            type: "passive",
                        },
                        {
                            id: "sharp_beak",
                            name: "üó°Ô∏è Sharp Beak",
                            description: "+1 apple per click",
                            baseCost: 25,
                            clickIncrease: 1,
                            costMultiplier: 1.2,
                            type: "click",
                        },
                        {
                            id: "strong_wings",
                            name: "üí™ Strong Wings",
                            description: "+3 apples per click",
                            baseCost: 150,
                            clickIncrease: 3,
                            costMultiplier: 1.2,
                            type: "click",
                        },
                        {
                            id: "golden_feathers",
                            name: "‚ú® Golden Feathers",
                            description: "+10 apples per click",
                            baseCost: 750,
                            clickIncrease: 10,
                            costMultiplier: 1.2,
                            type: "click",
                        },
                        {
                            id: "magic_touch",
                            name: "ü™Ñ Magic Touch",
                            description: "+25 apples per click",
                            baseCost: 3000,
                            clickIncrease: 25,
                            costMultiplier: 1.2,
                            type: "click",
                        },
                        {
                            id: "apple_magnet",
                            name: "üß≤ Apple Magnet",
                            description: "+75 apples per click",
                            baseCost: 15000,
                            clickIncrease: 75,
                            costMultiplier: 1.2,
                            type: "click",
                        },
                        {
                            id: "auto_pecker",
                            name: "ü§ñ Auto Pecker",
                            description: "0.1 clicks per second",
                            baseCost: 100,
                            autoClickIncrease: 0.1,
                            costMultiplier: 1.3,
                            type: "auto",
                        },
                        {
                            id: "click_bot",
                            name: "ü¶æ Click Bot",
                            description: "0.5 clicks per second",
                            baseCost: 1000,
                            autoClickIncrease: 0.5,
                            costMultiplier: 1.3,
                            type: "auto",
                        },
                        {
                            id: "robo_goose",
                            name: "ü§ñ Robo Goose",
                            description: "2 clicks per second",
                            baseCost: 10000,
                            autoClickIncrease: 2,
                            costMultiplier: 1.3,
                            type: "auto",
                        },
                        {
                            id: "quantum_clicker",
                            name: "‚öõÔ∏è Quantum Clicker",
                            description: "10 clicks per second",
                            baseCost: 100000,
                            autoClickIncrease: 10,
                            costMultiplier: 1.3,
                            type: "auto",
                        },
                    ];

                    this.achievements = [
                        {
                            id: "first_click",
                            name: "First Steps",
                            description: "Click the goose for the first time",
                            condition: () => this.gameState.totalClicks >= 1,
                        },
                        {
                            id: "hundred_clicks",
                            name: "Clicking Champion",
                            description: "Click the goose 100 times",
                            condition: () => this.gameState.totalClicks >= 100,
                        },
                        {
                            id: "first_upgrade",
                            name: "Getting Help",
                            description: "Buy your first upgrade",
                            condition: () =>
                                Object.values(this.gameState.upgrades).some(
                                    (count) => count > 0,
                                ),
                        },
                        {
                            id: "thousand_apples",
                            name: "Apple Collector",
                            description: "Collect 1,000 apples",
                            condition: () => this.gameState.totalApples >= 1000,
                        },
                        {
                            id: "ten_aps",
                            name: "Passive Income",
                            description: "Reach 10 apples per second",
                            condition: () =>
                                this.gameState.applesPerSecond >= 10,
                        },
                        {
                            id: "first_prestige",
                            name: "New Beginnings",
                            description: "Prestige for the first time",
                            condition: () => this.gameState.prestigeLevel >= 1,
                        },
                        {
                            id: "million_apples",
                            name: "Millionaire",
                            description: "Collect 1,000,000 total apples",
                            condition: () =>
                                this.gameState.totalApples >= 1000000,
                        },
                    ];

                    this.init();
                }

                init() {
                    this.loadGame();
                    this.calculateOfflineProgress();
                    this.setupEventListeners();
                    this.setupTabs();
                    this.createUpgradeElements();
                    this.createAchievementElements();
                    this.calculateClickPower();
                    this.calculateAutoClicksPerSecond();
                    this.createDecorativeApples();
                    this.updateDisplay();
                    this.startGameLoop();
                    this.startAutoClicker();
                }

                setupEventListeners() {
                    document
                        .getElementById("mainGoose")
                        .addEventListener("click", (e) => this.clickGoose(e));

                    // Mobile menu toggle
                    const mobileToggle =
                        document.getElementById("mobileMenuToggle");
                    const mobileClose =
                        document.getElementById("mobileMenuClose");
                    const sidebar = document.querySelector(".sidebar");

                    const toggleMenu = () => {
                        sidebar.classList.toggle("mobile-open");
                        mobileToggle.textContent = sidebar.classList.contains(
                            "mobile-open",
                        )
                            ? "üì± Hide Menu"
                            : "üì± Show Menu";
                    };

                    mobileToggle.addEventListener("click", toggleMenu);
                    mobileClose.addEventListener("click", toggleMenu);
                }

                setupTabs() {
                    const upgradesTab = document.getElementById("upgradesTab");
                    const achievementsTab =
                        document.getElementById("achievementsTab");
                    const clickTab = document.getElementById("clickTab");
                    const autoTab = document.getElementById("autoTab");
                    const upgradesContent =
                        document.getElementById("upgradesContent");
                    const achievementsContent = document.getElementById(
                        "achievementsContent",
                    );
                    const clickContent =
                        document.getElementById("clickContent");
                    const autoContent = document.getElementById("autoContent");

                    upgradesTab.addEventListener("click", () => {
                        upgradesTab.classList.add("active");
                        achievementsTab.classList.remove("active");
                        clickTab.classList.remove("active");
                        autoTab.classList.remove("active");
                        upgradesContent.classList.add("active");
                        achievementsContent.classList.remove("active");
                        clickContent.classList.remove("active");
                        autoContent.classList.remove("active");
                    });

                    achievementsTab.addEventListener("click", () => {
                        achievementsTab.classList.add("active");
                        upgradesTab.classList.remove("active");
                        clickTab.classList.remove("active");
                        autoTab.classList.remove("active");
                        achievementsContent.classList.add("active");
                        upgradesContent.classList.remove("active");
                        clickContent.classList.remove("active");
                        autoContent.classList.remove("active");
                    });

                    clickTab.addEventListener("click", () => {
                        clickTab.classList.add("active");
                        upgradesTab.classList.remove("active");
                        achievementsTab.classList.remove("active");
                        autoTab.classList.remove("active");
                        clickContent.classList.add("active");
                        upgradesContent.classList.remove("active");
                        achievementsContent.classList.remove("active");
                        autoContent.classList.remove("active");
                    });

                    autoTab.addEventListener("click", () => {
                        autoTab.classList.add("active");
                        upgradesTab.classList.remove("active");
                        achievementsTab.classList.remove("active");
                        clickTab.classList.remove("active");
                        autoContent.classList.add("active");
                        upgradesContent.classList.remove("active");
                        achievementsContent.classList.remove("active");
                        clickContent.classList.remove("active");
                    });
                }

                clickGoose(event) {
                    const clickValue =
                        this.gameState.clickPower *
                        this.gameState.prestigeMultiplier;
                    this.gameState.apples += clickValue;
                    this.gameState.totalApples += clickValue;
                    this.gameState.totalClicks++;

                    // Track click time for dynamic per second calculation
                    const now = Date.now();
                    this.clickTimes.push(now);

                    // Keep only clicks from the last 10 seconds for accurate rate calculation
                    this.clickTimes = this.clickTimes.filter(
                        (time) => now - time <= 10000,
                    );

                    // Calculate dynamic clicks per second based on recent clicks
                    if (this.clickTimes.length > 1) {
                        const timeSpan = (now - this.clickTimes[0]) / 1000; // Convert to seconds
                        this.dynamicClicksPerSecond =
                            this.clickTimes.length / Math.max(timeSpan, 1);
                    } else {
                        this.dynamicClicksPerSecond = this.clickTimes.length;
                    }

                    // Create click effect
                    this.createClickEffect(event, clickValue);

                    // Add continuous shake animation
                    const goose = document.getElementById("mainGoose");

                    // Start shaking if not already shaking
                    if (!goose.classList.contains("shake")) {
                        goose.classList.add("shake");
                    }

                    // Clear existing timeout and set new one to stop shaking
                    if (this.shakeTimeout) {
                        clearTimeout(this.shakeTimeout);
                    }

                    this.shakeTimeout = setTimeout(() => {
                        goose.classList.remove("shake");
                        this.shakeTimeout = null;
                    }, 400); // Stop shaking 0.4s after last click

                    this.checkAchievements();
                    this.updateDisplay();
                    this.saveGame();
                }

                createClickEffect(event, value) {
                    const effect = document.createElement("div");
                    effect.className = "click-effect";
                    effect.textContent = `+${this.formatNumber(value)}`;
                    effect.style.left = event.clientX + "px";
                    effect.style.top = event.clientY + "px";
                    document.body.appendChild(effect);

                    setTimeout(() => {
                        document.body.removeChild(effect);
                    }, 1000);
                }

                buyUpgrade(upgradeId, quantity = 1) {
                    const upgrade = this.upgrades.find(
                        (u) => u.id === upgradeId,
                    );
                    const currentCount =
                        this.gameState.upgrades[upgradeId] || 0;

                    let actualQuantity = quantity;
                    let totalCost = 0;

                    // Calculate actual quantity and cost
                    if (quantity === "max") {
                        actualQuantity = this.calculateMaxBuy(
                            upgrade,
                            currentCount,
                        );
                        totalCost = this.calculateBulkCost(
                            upgrade,
                            currentCount,
                            actualQuantity,
                        );
                    } else {
                        actualQuantity = Math.min(
                            quantity,
                            this.calculateMaxBuy(upgrade, currentCount),
                        );
                        totalCost = this.calculateBulkCost(
                            upgrade,
                            currentCount,
                            actualQuantity,
                        );
                    }

                    if (
                        actualQuantity > 0 &&
                        this.gameState.apples >= totalCost
                    ) {
                        this.gameState.apples -= totalCost;
                        this.gameState.upgrades[upgradeId] =
                            currentCount + actualQuantity;

                        if (upgrade.type === "passive") {
                            this.calculateApplesPerSecond();
                        } else if (upgrade.type === "click") {
                            this.calculateClickPower();
                        } else if (upgrade.type === "auto") {
                            this.calculateAutoClicksPerSecond();
                            // Restart auto-clicker when auto upgrades are bought
                            this.startAutoClicker();
                        }

                        this.checkAchievements();
                        this.updateDisplay();
                        this.saveGame();
                    }
                }

                calculateBulkCost(upgrade, currentCount, quantity) {
                    let totalCost = 0;
                    for (let i = 0; i < quantity; i++) {
                        totalCost += Math.floor(
                            upgrade.baseCost *
                                Math.pow(
                                    upgrade.costMultiplier,
                                    currentCount + i,
                                ),
                        );
                    }
                    return totalCost;
                }

                calculateMaxBuy(upgrade, currentCount) {
                    let count = 0;
                    let totalCost = 0;
                    while (true) {
                        const nextCost = Math.floor(
                            upgrade.baseCost *
                                Math.pow(
                                    upgrade.costMultiplier,
                                    currentCount + count,
                                ),
                        );
                        if (totalCost + nextCost > this.gameState.apples) {
                            break;
                        }
                        totalCost += nextCost;
                        count++;
                        if (count >= 1000) break; // Safety limit
                    }
                    return count;
                }

                calculateApplesPerSecond() {
                    let aps = 0;
                    this.upgrades.forEach((upgrade) => {
                        if (upgrade.type === "passive") {
                            const count =
                                this.gameState.upgrades[upgrade.id] || 0;
                            aps += upgrade.bpsIncrease * count;
                        }
                    });
                    this.gameState.applesPerSecond =
                        aps * this.gameState.prestigeMultiplier;

                    // Update falling apples when production changes
                    this.createDecorativeApples();
                }

                calculateClickPower() {
                    let clickPower = 1; // Base click power
                    this.upgrades.forEach((upgrade) => {
                        if (upgrade.type === "click") {
                            const count =
                                this.gameState.upgrades[upgrade.id] || 0;
                            clickPower += upgrade.clickIncrease * count;
                        }
                    });
                    this.gameState.clickPower = clickPower;
                }

                calculateAutoClicksPerSecond() {
                    let autoClicks = 0;
                    this.upgrades.forEach((upgrade) => {
                        if (upgrade.type === "auto") {
                            const count =
                                this.gameState.upgrades[upgrade.id] || 0;
                            autoClicks += upgrade.autoClickIncrease * count;
                        }
                    });
                    this.gameState.autoClicksPerSecond = autoClicks;

                    // Update falling apples when auto-click rate changes
                    this.createDecorativeApples();
                }

                prestige() {
                    if (this.gameState.totalApples >= 1000000) {
                        this.gameState.prestigeLevel++;
                        this.gameState.prestigeMultiplier =
                            1 + this.gameState.prestigeLevel * 0.5;
                        this.gameState.apples = 0;
                        this.gameState.upgrades = {};
                        this.gameState.applesPerSecond = 0;
                        this.checkAchievements();
                        this.updateDisplay();
                        this.saveGame();
                    }
                }

                checkAchievements() {
                    this.achievements.forEach((achievement) => {
                        if (
                            !this.gameState.achievements.has(achievement.id) &&
                            achievement.condition()
                        ) {
                            this.gameState.achievements.add(achievement.id);
                            this.showAchievementNotification(achievement);
                        }
                    });
                }

                showAchievementNotification(achievement) {
                    // Simple notification - could be enhanced with a proper notification system
                    console.log(
                        `Achievement Unlocked: ${achievement.name} - ${achievement.description}`,
                    );
                }

                createUpgradeElements() {
                    const upgradesContainer =
                        document.getElementById("upgrades");
                    const clickUpgradesContainer =
                        document.getElementById("clickUpgrades");
                    const autoUpgradesContainer =
                        document.getElementById("autoUpgrades");

                    this.upgrades.forEach((upgrade) => {
                        const upgradeElement = document.createElement("div");
                        upgradeElement.className = "upgrade";
                        upgradeElement.innerHTML = `
                        <div class="upgrade-count" id="count-${upgrade.id}">0</div>
                        <div class="upgrade-info">
                            <div class="upgrade-name">${upgrade.name}</div>
                            <div class="upgrade-description">${upgrade.description}</div>
                        </div>
                        <div class="upgrade-buttons">
                            <div class="buy-quantity-row">
                                <button class="upgrade-button" id="btn-${upgrade.id}-1">1</button>
                                <button class="upgrade-button" id="btn-${upgrade.id}-10">10</button>
                                <button class="upgrade-button" id="btn-${upgrade.id}-100">100</button>
                                <button class="upgrade-button max" id="btn-${upgrade.id}-max">Max</button>
                            </div>
                            <div class="upgrade-cost" id="cost-${upgrade.id}">${this.formatNumber(upgrade.baseCost)}</div>
                        </div>
                    `;

                        if (upgrade.type === "passive") {
                            upgradesContainer.appendChild(upgradeElement);
                        } else if (upgrade.type === "click") {
                            clickUpgradesContainer.appendChild(upgradeElement);
                        } else if (upgrade.type === "auto") {
                            autoUpgradesContainer.appendChild(upgradeElement);
                        }

                        // Add event listeners for each quantity button
                        document
                            .getElementById(`btn-${upgrade.id}-1`)
                            .addEventListener("click", () =>
                                this.buyUpgrade(upgrade.id, 1),
                            );
                        document
                            .getElementById(`btn-${upgrade.id}-10`)
                            .addEventListener("click", () =>
                                this.buyUpgrade(upgrade.id, 10),
                            );
                        document
                            .getElementById(`btn-${upgrade.id}-100`)
                            .addEventListener("click", () =>
                                this.buyUpgrade(upgrade.id, 100),
                            );
                        document
                            .getElementById(`btn-${upgrade.id}-max`)
                            .addEventListener("click", () =>
                                this.buyUpgrade(upgrade.id, "max"),
                            );
                    });
                }

                createAchievementElements() {
                    const achievementsContainer =
                        document.getElementById("achievements");
                    this.achievements.forEach((achievement) => {
                        const achievementElement =
                            document.createElement("div");
                        achievementElement.className = "achievement";
                        achievementElement.id = `achievement-${achievement.id}`;
                        achievementElement.innerHTML = `
                        <strong>${achievement.name}</strong><br>
                        <small>${achievement.description}</small>
                    `;
                        achievementsContainer.appendChild(achievementElement);
                    });
                }

                updateDisplay() {
                    document.getElementById("apples").textContent =
                        this.formatNumber(this.gameState.apples);

                    // Calculate total per second including both passive and dynamic clicking
                    const totalPerSecond =
                        this.gameState.applesPerSecond +
                        this.dynamicClicksPerSecond *
                            this.gameState.clickPower *
                            this.gameState.prestigeMultiplier;

                    document.getElementById("applesPerSecond").textContent =
                        this.formatNumber(totalPerSecond, 1);

                    // Update mobile stats
                    const mobileApples =
                        document.getElementById("mobileApples");
                    const mobileApplesPerSecond = document.getElementById(
                        "mobileApplesPerSecond",
                    );
                    if (mobileApples) {
                        mobileApples.textContent = this.formatNumber(
                            this.gameState.apples,
                        );
                    }
                    if (mobileApplesPerSecond) {
                        // Use same total per second calculation for mobile
                        const totalPerSecond =
                            this.gameState.applesPerSecond +
                            this.dynamicClicksPerSecond *
                                this.gameState.clickPower *
                                this.gameState.prestigeMultiplier;
                        mobileApplesPerSecond.textContent = this.formatNumber(
                            totalPerSecond,
                            1,
                        );
                    }

                    // Update upgrade buttons
                    this.upgrades.forEach((upgrade) => {
                        const currentCount =
                            this.gameState.upgrades[upgrade.id] || 0;
                        const countElement = document.getElementById(
                            `count-${upgrade.id}`,
                        );
                        const costElement = document.getElementById(
                            `cost-${upgrade.id}`,
                        );

                        countElement.textContent = currentCount;

                        // Update each quantity button
                        [1, 10, 100, "max"].forEach((qty) => {
                            const button = document.getElementById(
                                `btn-${upgrade.id}-${qty}`,
                            );

                            if (qty === "max") {
                                const maxBuy = this.calculateMaxBuy(
                                    upgrade,
                                    currentCount,
                                );
                                const maxCost = this.calculateBulkCost(
                                    upgrade,
                                    currentCount,
                                    maxBuy,
                                );
                                button.disabled =
                                    maxBuy === 0 ||
                                    this.gameState.apples < maxCost;
                            } else {
                                const cost = this.calculateBulkCost(
                                    upgrade,
                                    currentCount,
                                    qty,
                                );
                                const maxPossible = this.calculateMaxBuy(
                                    upgrade,
                                    currentCount,
                                );
                                button.disabled =
                                    qty > maxPossible ||
                                    this.gameState.apples < cost;
                            }
                        });

                        // Update cost display (show cost for buying 1)
                        const singleCost = Math.floor(
                            upgrade.baseCost *
                                Math.pow(upgrade.costMultiplier, currentCount),
                        );
                        costElement.textContent = this.formatNumber(singleCost);
                    });

                    // Update achievements
                    this.achievements.forEach((achievement) => {
                        const element = document.getElementById(
                            `achievement-${achievement.id}`,
                        );
                        if (this.gameState.achievements.has(achievement.id)) {
                            element.classList.add("unlocked");
                        }
                    });
                }

                formatNumber(num, decimals = 0) {
                    if (num < 1000) return num.toFixed(decimals);
                    if (num < 1000000) return (num / 1000).toFixed(1) + "K";
                    if (num < 1000000000)
                        return (num / 1000000).toFixed(1) + "M";
                    if (num < 1000000000000)
                        return (num / 1000000000).toFixed(1) + "B";
                    return (num / 1000000000000).toFixed(1) + "T";
                }

                startGameLoop() {
                    setInterval(() => {
                        if (this.gameState.applesPerSecond > 0) {
                            const gain = this.gameState.applesPerSecond / 10; // 10 updates per second
                            this.gameState.apples += gain;
                            this.gameState.totalApples += gain;
                        }

                        // Clean up old click times periodically
                        const now = Date.now();
                        this.clickTimes = this.clickTimes.filter(
                            (time) => now - time <= 10000,
                        );

                        // Recalculate dynamic click rate
                        if (this.clickTimes.length > 1) {
                            const timeSpan = (now - this.clickTimes[0]) / 1000;
                            this.dynamicClicksPerSecond =
                                this.clickTimes.length / Math.max(timeSpan, 1);
                        } else if (this.clickTimes.length === 1) {
                            // If only one click in the window, calculate based on that
                            this.dynamicClicksPerSecond =
                                this.clickTimes.length /
                                Math.min((now - this.clickTimes[0]) / 1000, 10);
                        } else {
                            this.dynamicClicksPerSecond = 0;
                        }

                        this.updateDisplay();
                    }, 100);

                    // Save every 30 seconds
                    setInterval(() => {
                        this.saveGame();
                    }, 30000);
                }

                saveGame() {
                    this.gameState.lastSaveTime = Date.now();
                    const saveData = {
                        ...this.gameState,
                        achievements: Array.from(this.gameState.achievements),
                    };
                    localStorage.setItem(
                        "idleGooseGame",
                        JSON.stringify(saveData),
                    );
                }

                loadGame() {
                    const saveData = localStorage.getItem("idleGooseGame");
                    if (saveData) {
                        const parsed = JSON.parse(saveData);
                        this.gameState = {
                            ...this.gameState,
                            ...parsed,
                            achievements: new Set(parsed.achievements || []),
                        };
                        this.calculateApplesPerSecond();
                        this.calculateClickPower();
                        this.calculateAutoClicksPerSecond();

                        // Update falling apples after loading
                        this.createDecorativeApples();

                        // Restart auto-clicker after loading to ensure it works with new rates
                        this.startAutoClicker();
                    }
                }

                startAutoClicker() {
                    // Clear any existing interval
                    if (this.autoClickInterval) {
                        clearInterval(this.autoClickInterval);
                    }

                    this.autoClickInterval = setInterval(() => {
                        if (this.gameState.autoClicksPerSecond > 0) {
                            // Calculate clicks to perform this interval (every 100ms)
                            const clicksThisInterval =
                                this.gameState.autoClicksPerSecond / 10;

                            // Handle fractional clicks by accumulating
                            this.autoClickAccumulator =
                                (this.autoClickAccumulator || 0) +
                                clicksThisInterval;

                            const clicksToPerform = Math.floor(
                                this.autoClickAccumulator,
                            );
                            this.autoClickAccumulator -= clicksToPerform;

                            for (let i = 0; i < clicksToPerform; i++) {
                                const clickValue =
                                    this.gameState.clickPower *
                                    this.gameState.prestigeMultiplier;
                                this.gameState.apples += clickValue;
                                this.gameState.totalApples += clickValue;
                                this.gameState.totalClicks++;

                                // Create auto-click effect with random position around goose
                                const goose =
                                    document.getElementById("mainGoose");
                                const gooseRect = goose.getBoundingClientRect();
                                const centerX =
                                    gooseRect.left + gooseRect.width / 2;
                                const centerY =
                                    gooseRect.top + gooseRect.height / 2;

                                // Random offset around the goose (within 50px radius)
                                const angle = Math.random() * 2 * Math.PI;
                                const radius = Math.random() * 50;
                                const offsetX = Math.cos(angle) * radius;
                                const offsetY = Math.sin(angle) * radius;

                                this.createAutoClickEffect(
                                    centerX + offsetX,
                                    centerY + offsetY,
                                    clickValue,
                                );

                                // Add auto clicks to click tracking for dynamic per second calculation
                                const now = Date.now();
                                this.clickTimes.push(now);
                                this.clickTimes = this.clickTimes.filter(
                                    (time) => now - time <= 10000,
                                );
                            }

                            if (clicksToPerform > 0) {
                                // Trigger shake animation for auto clicks
                                const goose =
                                    document.getElementById("mainGoose");
                                if (!goose.classList.contains("shake")) {
                                    goose.classList.add("shake");
                                }

                                if (this.shakeTimeout) {
                                    clearTimeout(this.shakeTimeout);
                                }

                                this.shakeTimeout = setTimeout(() => {
                                    goose.classList.remove("shake");
                                    this.shakeTimeout = null;
                                }, 400);

                                this.updateDisplay();
                            }
                        }
                    }, 100);
                }

                createAutoClickEffect(x, y, value) {
                    const effect = document.createElement("div");
                    effect.className = "click-effect";
                    effect.textContent = `+${this.formatNumber(value)}`;
                    effect.style.left = x + "px";
                    effect.style.top = y + "px";
                    effect.style.color = "#007bff"; // Blue color for auto-clicks
                    document.body.appendChild(effect);

                    setTimeout(() => {
                        if (document.body.contains(effect)) {
                            document.body.removeChild(effect);
                        }
                    }, 1000);
                }

                calculateOfflineProgress() {
                    if (
                        this.gameState.lastSaveTime &&
                        this.gameState.applesPerSecond > 0
                    ) {
                        const now = Date.now();
                        const timeDiff =
                            (now - this.gameState.lastSaveTime) / 1000; // Convert to seconds

                        // Only calculate offline progress if away for more than 10 seconds
                        if (timeDiff > 10) {
                            const offlineApples = Math.floor(
                                this.gameState.applesPerSecond * timeDiff,
                            );

                            if (offlineApples > 0) {
                                this.gameState.apples += offlineApples;
                                this.gameState.totalApples += offlineApples;

                                // Show offline progress notification
                                this.showOfflineProgress(
                                    offlineApples,
                                    timeDiff,
                                );
                            }
                        }

                        this.gameState.lastSaveTime = now;
                    }
                }

                showOfflineProgress(applesGained, timeAway) {
                    const hours = Math.floor(timeAway / 3600);
                    const minutes = Math.floor((timeAway % 3600) / 60);

                    let timeText = "";
                    if (hours > 0) {
                        timeText = `${hours}h ${minutes}m`;
                    } else if (minutes > 0) {
                        timeText = `${minutes}m`;
                    } else {
                        timeText = `${Math.floor(timeAway)}s`;
                    }

                    // Create and show offline progress popup
                    const popup = document.createElement("div");
                    popup.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: rgba(255, 255, 255, 0.95);
                        padding: 20px;
                        border-radius: 15px;
                        border: 3px solid #28a745;
                        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                        z-index: 1000;
                        text-align: center;
                        font-weight: bold;
                        color: #333;
                    `;

                    popup.innerHTML = `
                        <h3 style="margin: 0 0 10px 0; color: #28a745;">üçé Welcome Back! üçé</h3>
                        <p style="margin: 5px 0;">You were away for: <strong>${timeText}</strong></p>
                        <p style="margin: 5px 0;">Your geese collected: <strong>${this.formatNumber(applesGained)} apples</strong></p>
                        <button onclick="this.parentElement.remove()" style="
                            background: #28a745;
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 5px;
                            cursor: pointer;
                            font-weight: bold;
                            margin-top: 10px;
                        ">Collect Apples!</button>
                    `;

                    document.body.appendChild(popup);
                }

                createDecorativeApples() {
                    const container =
                        document.getElementById("decorativeApples");

                    // Clear existing apples
                    container.innerHTML = "";

                    // Calculate apple count based on apples per second (1 apple per 10 aps, min 3, max 25)
                    const baseApples = Math.floor(
                        this.gameState.applesPerSecond / 10,
                    );
                    const appleCount = Math.max(3, Math.min(25, baseApples));

                    for (let i = 0; i < appleCount; i++) {
                        const apple = document.createElement("div");
                        apple.className = "apple";
                        apple.textContent = "üçé";

                        // Random horizontal positioning
                        apple.style.left = Math.random() * 90 + "%";

                        // Random fall duration (8-15 seconds)
                        apple.style.animationDuration =
                            8 + Math.random() * 7 + "s";

                        container.appendChild(apple);
                    }
                }
            }

            // Start the game when page loads
            window.addEventListener("load", () => {
                new IdleGooseGame();
            });
        </script>
    </body>
</html>
